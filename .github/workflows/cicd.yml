  deploy:
    needs: build
    runs-on: self-hosted
    steps:
      - name: Pull image from docker hub
        run: docker pull hunderedacress/100acressfront:latest

      - name: Delete old container
        run: |
          if [ "$(docker ps -aq -f name=hundredacress-frontend-container)" ]; then
            docker rm -f hundredacress-frontend-container
          fi

      - name: Kill process on port 3000 (if any)
        run: |
          if sudo lsof -i :3000 -t | grep -q . ; then
            echo "Port 3000 is in use. Killing the process..."
            sudo fuser -k 3000/tcp
          else
            echo "Port 3000 is free."
          fi

      - name: Run Docker Container
        run: docker run -d -p 3000:80 --name hundredacress-frontend-container hunderedacress/100acressfront
