name: Deploy Frontend

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Pull latest frontend image from Docker Hub
        run: docker pull hunderedacress/100acressfront:latest

      - name: Remove existing container if it exists
        run: |
          if [ "$(docker ps -aq -f name=hundredacress-frontend-container)" ]; then
            echo "Stopping and removing existing container..."
            docker rm -f hundredacress-frontend-container
          else
            echo "No existing container to remove."
          fi

      - name: Free up port 3001 (if used by another container)
        run: |
          CONTAINER_ID=$(docker ps --filter "publish=3001" -q)
          if [ -n "$CONTAINER_ID" ]; then
            echo "Port 3001 is in use by container $CONTAINER_ID, stopping..."
            docker stop "$CONTAINER_ID"
            docker rm "$CONTAINER_ID"
          else
            echo "Port 3001 is free."
          fi

      - name: Run frontend container on port 3001
        run: |
          docker run -d \
            -p 3001:80 \
            --name hundredacress-frontend-container \
            hunderedacress/100acressfront:latest
